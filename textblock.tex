% The margin at the spine of each page.
% After setting this, call \fittextblock
\newdimen\spinemargin

% The margin at the outer edge of each page.
% This is set by \fittextblock
\newdimen\edgemargin

% The number of lines of text in each textblock
\newcount\textblocklines

\def\leftmargin{\ifodd\pageno \spinemargin\else\edgemargin\fi}

% Adjust the textblock to fit the current values of:
% - \pdfpagewidth
% - \hsize
% - \spinemargin
% - \textblocklines
% - \leading
% - \bodytextsize
\def\fittextblock{
  \edgemargin=\pdfpagewidth
    \advance\edgemargin by -\hsize
    \advance\edgemargin by -\spinemargin
  \topskip=\bodytextsize
  \splittopskip=\topskip
  \maxdepth=\leading
    \advance\maxdepth by -\bodytextsize
  \splitmaxdepth=\maxdepth
  \vsize=\textblocklines\leading
    \advance\vsize by -\maxdepth
}

\def\showtextblock{
  \message{\string\voffset: \the\voffset}
  \message{\string\spinemargin: \the\spinemargin}
  \message{\string\edgemargin: \the\edgemargin}
  \message{\string\hsize: \the\hsize}
  \message{\string\textblocklines: \the\textblocklines}
  \message{\string\vsize: \the\vsize}
  \message{\string\maxdepth: \the\maxdepth}
  \message{\string\topskip: \the\topskip}
}
