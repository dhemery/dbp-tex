\countdef\pageno=0 % TeX writes \count0 to the log when shipping a page out

\def\nextpage{\vfil\eject\useclearedframethispage}
\def\nextrectopage{\nextpage\onrectopage}
\def\nextversopage{\nextpage\ifodd\pageno \line{}\nextpage\else\fi}
\def\onrectopage{\ifodd\pageno \else\line{}\nextpage\fi}

\def\eject{\par\break}

\def\advancepageno{\ifnum\pageno<0 \global\advance\pageno by -1 \else\global\advance\pageno by 1 \fi}
\def\folio{\number\pageno}

\def\facingpages{
  \hoffset=\leftmargin
  \shipout\page
  \userunningpageframe
  \advancepageno
}

\def\page{
  \vbox{
    \headline
    \textblock
    \footline
  }
}

\def\textblock{
  \vbox to \vsize{
    \boxmaxdepth=\maxdepth
    \unvbox255
  }
}

\pageno=1
\output{\facingpages}

\brokenpenalty=100
\interlinepenalty=0
\clubpenalty=0 % Bringhurst says don't worry about these.
\widowpenalty=700
\predisplaypenalty=10000
\displaywidowpenalty=50
