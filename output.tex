\let\ifoutlinetextblock=\iffalse

\def\shiponepage{
  \hoffset=\leftmargin
  \shipout\page
  \userunningpageframe
  \advancepageno
}

\def\page{
  \vbox{
    \headline
    \textblock
    \footline
  }
}

\def\hruleat#1{\kern#1 \hrule width \hsize height .2pt \kern-0.2pt \kern-#1 }
\def\outlinetextblock{
  \dimen0=-\headskip \advance\dimen0 by \topskip
  \hruleat\dimen0 % headline
  \hrule width \hsize \kern-0.4pt % top
  \hruleat\topskip % first baseline
  \dimen0=\vsize
  \hruleat\dimen0 % last baseline
  \advance\dimen0 by \maxdepth
  \hruleat\dimen0 % bottom
  \dimen0=\vsize \advance\dimen0 by \footskip
  \hruleat\dimen0 % footline
}

\def\textblock{
  \ifoutlinetextblock\outlinetextblock\fi
  \vbox to \vsize{
    \boxmaxdepth=\maxdepth
    \unvbox255
  }
}

\def\facingpages{
  \gdef\routinename{\string\facingpages}
  \shiponepage
}

\def\balancedspreads{
  \gdef\routinename{\string\balancedspreads}
  \ifnum\outputpenalty>0
    \ifnum\outputpenalty<10000
      \gdef\sadness{\the\outputpenalty}
    \fi
  \fi
  \shiponepage
  \gdef\sadness{}
}

\def\headline{\vbox to 0pt{\positionhead\line{\runningheadtype\the\head}\vss\nointerlineskip}}
\def\footline{\vbox to 0pt{\positionfoot\line{\hbox to 0pt{\runningheadtype\routinename\ \sadness\hss}\runningheadtype\the\foot}\vss\nointerlineskip}}
\def\positionhead{\vskip.33333\leading\vskip-\headskip}
\def\positionfoot{\vskip-1.33333\leading\vskip\footskip}
\def\sadness{}
